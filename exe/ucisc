#!/usr/bin/env ruby

require "bundler/setup"
require "micro_cisc"
require "byebug"

if ARGV.length < 1
  puts "Usage:"
  puts "  ucisc <file_name>"
  exit(0)
end

file_name = ARGV.first
puts "Reading #{file_name}"
compiler = MicroCisc.load(file_name)
puts "Running program with #{compiler.serialize.size} words"

begin
  MicroCisc.run(compiler.serialize)
rescue StandardError => e
  puts "Execution terminated: #{e.message}"
  puts "  #{e.backtrace.join("\n  ")}"
end

puts "Done."
